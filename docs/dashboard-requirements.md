# ëŒ€ì‹œë³´ë“œ ìš”êµ¬ì‚¬í•­ ëª…ì„¸

## 1. ì¼ìë³„ DB
**ê¸°ê°„**: ë‹¹ì›” 1ì¼ ~ ë‹¹ì›” ë§ì¼
**ë°ì´í„°**: DB ìœ ì…ìˆ˜ (leads í…Œì´ë¸”)
**ì¿¼ë¦¬ ì¡°ê±´**:
```sql
WHERE created_at >= 'ë‹¹ì›” 1ì¼ 00:00:00'
  AND created_at <= 'ë‹¹ì›” ë§ì¼ 23:59:59'
  AND company_id = [í˜„ì¬ íšŒì‚¬ ID]
GROUP BY DATE(created_at)
```

**í‘œì‹œ**: ë§‰ëŒ€ ê·¸ë˜í”„ (ì¼ë³„ DB ìœ ì…ìˆ˜)

---

## 2. ê²°ê³¼ë³„ DB
**ê¸°ê°„**: ìµœê·¼ 7ì¼
**ë°ì´í„°**: DB ê²°ê³¼ë³„ í†µê³„ (ìˆ˜ëŸ‰ + ë¹„ìœ¨)
**ì¿¼ë¦¬ ì¡°ê±´**:
```sql
WHERE created_at >= 'ì˜¤ëŠ˜ - 7ì¼'
  AND company_id = [í˜„ì¬ íšŒì‚¬ ID]
GROUP BY DATE(created_at), status
```

**DB ê²°ê³¼ í•­ëª© (8ê°œ)**:
1. DB ìœ ì… (total count)
2. ìƒë‹´ ì „ (status = 'pending' OR 'new')
3. ìƒë‹´ ê±°ì ˆ (status = 'rejected')
4. ìƒë‹´ ì§„í–‰ì¤‘ (status = 'contacted' OR 'qualified')
5. ìƒë‹´ ì™„ë£Œ (status = 'converted')
6. ê³„ì•½ ì™„ë£Œ (ë³„ë„ í•„ë“œ í•„ìš” ë˜ëŠ” status)
7. ì¶”ê°€ìƒë‹´ í•„ìš” (ë³„ë„ í•„ë“œ í•„ìš”)
8. ê¸°íƒ€ (ê¸°íƒ€ ìƒíƒœ)

**í‘œì‹œ**: í…Œì´ë¸” (ë‚ ì§œë³„ í–‰, ìƒíƒœë³„ ì—´)
**ë¹„ìœ¨ ê³„ì‚°**: (í•´ë‹¹ ìƒíƒœ ìˆ˜ëŸ‰ / DB ìœ ì… ì´ìˆ˜) * 100, ë°˜ì˜¬ë¦¼

---

## 3. íŠ¸ë˜í”½ ìœ ì…
**ê¸°ê°„**: ë‹¹ì›” 1ì¼ ~ ë‹¹ì›” ë§ì¼
**ë°ì´í„°**: ëœë”©í˜ì´ì§€ ì¡°íšŒ ìˆ˜
**í•„ìš” ë°ì´í„°**: landing_pages í…Œì´ë¸” ë˜ëŠ” ë³„ë„ analytics í…Œì´ë¸”

**ì£¼ì˜**: í˜„ì¬ êµ¬í˜„ì—ì„œëŠ” leads ë°ì´í„°ë¥¼ ì‚¬ìš© ì¤‘ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” **í˜ì´ì§€ë·° íŠ¸ë˜í‚¹ ë°ì´í„°**ê°€ í•„ìš”

**ì¿¼ë¦¬ ì¡°ê±´**:
```sql
-- í–¥í›„ êµ¬í˜„ ì‹œ
WHERE view_date >= 'ë‹¹ì›” 1ì¼'
  AND view_date <= 'ë‹¹ì›” ë§ì¼'
  AND company_id = [í˜„ì¬ íšŒì‚¬ ID]
GROUP BY DATE(view_date)
```

**í‘œì‹œ**: ë§‰ëŒ€ ê·¸ë˜í”„ (ì¼ë³„ í˜ì´ì§€ë·° ìˆ˜)

---

## 4. íŠ¸ë˜í”½ íš¨ìœ¨
**ê¸°ê°„**: ìµœê·¼ 7ì¼
**ë°ì´í„°**: íŠ¸ë˜í”½ ìœ ì… ë° DB ì „í™˜ í†µê³„

### 4-1. íŠ¸ë˜í”½ ìœ ì… (í˜ì´ì§€ë³„)
**í•­ëª©**:
- ë‚ ì§œ
- í•©ê³„ (ì´ í˜ì´ì§€ë·°)
- PC (ê±´ìˆ˜ + ë¹„ìœ¨%)
- Mobile (ê±´ìˆ˜ + ë¹„ìœ¨%)
- ê¸°íƒ€ (ê±´ìˆ˜ + ë¹„ìœ¨%)

**ë°ì´í„° ì†ŒìŠ¤**:
- User-Agent ê¸°ë°˜ ë””ë°”ì´ìŠ¤ ë¶„ë¥˜
- ë˜ëŠ” ë³„ë„ analytics í…Œì´ë¸”ì˜ device_type í•„ë“œ

### 4-2. DB ìœ ì… ì „í™˜
**í•­ëª©**:
- í•©ê³„ (DB ìœ ì… ìˆ˜ + ì „í™˜ìœ¨%)
- PC (ê±´ìˆ˜ + ë¹„ìœ¨%)
- Mobile (ê±´ìˆ˜ + ë¹„ìœ¨%)
- ê¸°íƒ€ (ê±´ìˆ˜)

**ì „í™˜ìœ¨ ê³„ì‚°**:
```
ì „í™˜ìœ¨ = (DB ìœ ì… / íŠ¸ë˜í”½ ìœ ì…) * 100
```

**ë¹„ìœ¨ ê³„ì‚°**: Math.round() ì‚¬ìš©í•˜ì—¬ ë°˜ì˜¬ë¦¼

---

## 5. DB í™•ì¸ ë²„íŠ¼
**ê¸°ëŠ¥**: í´ë¦­ ì‹œ 'DB í˜„í™©' í˜ì´ì§€ë¡œ ì´ë™
**ë¼ìš°íŒ…**: `/dashboard/leads` (DB í˜„í™© í˜ì´ì§€)

---

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ vs ìš”êµ¬ì‚¬í•­

### âœ… êµ¬í˜„ ì™„ë£Œ
- ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ë””ìì¸
- DB í™•ì¸ ë²„íŠ¼ ë¼ìš°íŒ…
- ë‚ ì§œ ê¸°ë°˜ í•„í„°ë§ ë¡œì§

### âš ï¸ ìˆ˜ì • í•„ìš”
1. **ì¼ìë³„ DB**:
   - í˜„ì¬: ìµœê·¼ 30ì¼
   - ìš”êµ¬: ë‹¹ì›” 1ì¼ ~ ë§ì¼

2. **ê²°ê³¼ë³„ DB**:
   - í˜„ì¬: ì´ë²ˆ ë‹¬ ì „ì²´
   - ìš”êµ¬: ìµœê·¼ 7ì¼
   - DB ê²°ê³¼ í•­ëª© 8ê°œ ì •í™•íˆ ë§¤í•‘ í•„ìš”

3. **íŠ¸ë˜í”½ ìœ ì…**:
   - í˜„ì¬: leads ë°ì´í„° ì‚¬ìš©
   - ìš”êµ¬: ëœë”©í˜ì´ì§€ ì¡°íšŒ ìˆ˜ (ë³„ë„ íŠ¸ë˜í‚¹ í•„ìš”)

4. **íŠ¸ë˜í”½ íš¨ìœ¨**:
   - í˜„ì¬: ì„ì˜ ê³„ì‚° (30%, 70% ë¹„ìœ¨)
   - ìš”êµ¬: ì‹¤ì œ ë””ë°”ì´ìŠ¤ë³„ ë°ì´í„° + ì „í™˜ìœ¨ ê³„ì‚°

### ğŸ“‹ ì¶”ê°€ êµ¬í˜„ í•„ìš”
1. ëœë”©í˜ì´ì§€ ì¡°íšŒ íŠ¸ë˜í‚¹ ì‹œìŠ¤í…œ
2. User-Agent ê¸°ë°˜ ë””ë°”ì´ìŠ¤ ë¶„ë¥˜
3. DB ìƒíƒœ í•„ë“œ í™•ì¥ (ê³„ì•½ ì™„ë£Œ, ì¶”ê°€ìƒë‹´ í•„ìš”)
4. Analytics í…Œì´ë¸” ì„¤ê³„ (ì„ íƒì )

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìš”êµ¬ì‚¬í•­

### leads í…Œì´ë¸” í™•ì¥ í•„ìš”
```sql
ALTER TABLE leads ADD COLUMN IF NOT EXISTS device_type VARCHAR(20); -- 'pc', 'mobile', 'other'
ALTER TABLE leads ADD COLUMN IF NOT EXISTS contract_status VARCHAR(20); -- 'ê³„ì•½ ì™„ë£Œ' ë“±
ALTER TABLE leads ADD COLUMN IF NOT EXISTS needs_followup BOOLEAN; -- 'ì¶”ê°€ìƒë‹´ í•„ìš”'
```

### ì„ íƒ: page_views í…Œì´ë¸” ìƒì„±
```sql
CREATE TABLE page_views (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  company_id UUID REFERENCES companies(id),
  landing_page_id UUID REFERENCES landing_pages(id),
  device_type VARCHAR(20), -- 'pc', 'mobile', 'tablet', 'other'
  user_agent TEXT,
  ip_address INET,
  viewed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_page_views_company_date ON page_views(company_id, DATE(viewed_at));
CREATE INDEX idx_page_views_device ON page_views(device_type);
```

---

## DB í˜„í™© í˜ì´ì§€ ì¶”ê°€ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### ê³„ì•½ ì™„ë£Œ ë‚ ì§œ/ì‹œê°„ ì§€ì • ê¸°ëŠ¥
**ìš”êµ¬ì‚¬í•­**: ê³„ì•½ì™„ë£Œ ê±´ì— í•œí•˜ì—¬ 'ê³„ì•½ ì™„ë£Œ' ì—´ì— ë‚ ì§œ ë° ì‹œê°„ì„ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ í•¨
**ìš©ë„**: í•´ë‹¹ ë°ì´í„°ëŠ” 'DB ìŠ¤ì¼€ì¤„' í˜ì´ì§€ì— í™œìš©ë  ì˜ˆì •

**êµ¬í˜„ ë°©í–¥**:
1. **í…Œì´ë¸” ì»¬ëŸ¼**: `contract_completed_at` TIMESTAMP í•„ë“œ ì‚¬ìš©
2. **UI êµ¬í˜„**:
   - ê³„ì•½ ì™„ë£Œ ìƒíƒœì¼ ë•Œë§Œ ë‚ ì§œ/ì‹œê°„ ì…ë ¥ ê°€ëŠ¥
   - ì¸ë¼ì¸ ë‚ ì§œ/ì‹œê°„ ì„ íƒê¸° ë˜ëŠ” ëª¨ë‹¬ ë°©ì‹
   - ì„ íƒëœ ë‚ ì§œ/ì‹œê°„ í‘œì‹œ ë° ìˆ˜ì • ê¸°ëŠ¥
3. **ë°ì´í„° ì—°ë™**:
   - DB ìŠ¤ì¼€ì¤„ í˜ì´ì§€ì—ì„œ `contract_completed_at` ê¸°ì¤€ìœ¼ë¡œ ì¼ì • í‘œì‹œ
   - ìº˜ë¦°ë” ë·°ì— ê³„ì•½ ì™„ë£Œ ì¼ì • í‘œì‹œ

**ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**:
```sql
-- leads í…Œì´ë¸”ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í•„ë“œ í™œìš©
contract_completed_at TIMESTAMP WITH TIME ZONE
-- statusê°€ 'contract_completed'ì¼ ë•Œë§Œ ì´ í•„ë“œì— ê°’ ì…ë ¥
```

---

## êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: ë°ì´í„° ì •í™•ì„± (ê¸´ê¸‰)
1. ì¼ìë³„ DB: ë‹¹ì›” ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •
2. ê²°ê³¼ë³„ DB: ìµœê·¼ 7ì¼ + 8ê°œ í•­ëª© ì •í™•íˆ ë§¤í•‘

### Phase 2: íŠ¸ë˜í”½ íŠ¸ë˜í‚¹ (ì¤‘ìš”)
1. ëœë”©í˜ì´ì§€ ì¡°íšŒ ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹ êµ¬í˜„
2. User-Agent íŒŒì‹± ë° ë””ë°”ì´ìŠ¤ ë¶„ë¥˜

### Phase 3: DB ìƒíƒœ í™•ì¥ (ì„ íƒ)
1. leads í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¥
2. ê³„ì•½ ì™„ë£Œ, ì¶”ê°€ìƒë‹´ í•„ìš” ìƒíƒœ ì¶”ê°€

### Phase 4: ê³„ì•½ ì™„ë£Œ ì¼ì • ê´€ë¦¬ (ìƒˆë¡œìš´ ìš”êµ¬ì‚¬í•­)
1. DB í˜„í™© í˜ì´ì§€ì— ê³„ì•½ ì™„ë£Œ ë‚ ì§œ/ì‹œê°„ ì§€ì • UI êµ¬í˜„
2. ì¸ë¼ì¸ í¸ì§‘ ë˜ëŠ” ëª¨ë‹¬ ë°©ì‹ìœ¼ë¡œ ë‚ ì§œ/ì‹œê°„ ì„ íƒ
3. DB ìŠ¤ì¼€ì¤„ í˜ì´ì§€ì™€ ë°ì´í„° ì—°ë™

### Phase 5: DB ìŠ¤ì¼€ì¤„ í˜ì´ì§€ êµ¬í˜„
ìì„¸í•œ ëª…ì„¸ëŠ” [db-schedule-requirements.md](./db-schedule-requirements.md) ì°¸ì¡°

1. **ìƒíƒœ í•„í„° êµ¬í˜„** (4ê°œ í•­ëª©ë§Œ ë…¸ì¶œ):
   - ìƒë‹´ ì „ (`new`, `pending`)
   - ìƒë‹´ ì§„í–‰ì¤‘ (`contacted`, `qualified`)
   - ì¶”ê°€ìƒë‹´ í•„ìš” (`needs_followup`)
   - ê¸°íƒ€ (`other`)
   - ë°ì´í„° ì—†ëŠ” í•­ëª©ì€ ë¯¸ë…¸ì¶œ

2. **DB í˜„í™© í˜ì´ì§€ ì—°ë™**:
   - ê° ìƒíƒœ í´ë¦­ ì‹œ DB í˜„í™© í˜ì´ì§€ë¡œ ì´ë™
   - ë‚ ì§œ + ìƒíƒœ ìë™ í•„í„°ë§ ì ìš©

3. **ìº˜ë¦°ë” ë·° í†µí•©**:
   - ê³„ì•½ ì™„ë£Œ ì¼ì • í‘œì‹œ (`contract_completed_at`)
   - ê¸°ì¡´ ìº˜ë¦°ë” ì´ë²¤íŠ¸ì™€ í†µí•©

### Phase 6: ì˜ˆì•½ ìŠ¤ì¼€ì¤„ í˜ì´ì§€ êµ¬í˜„ âœ…
ìì„¸í•œ ëª…ì„¸ëŠ” [reservation-schedule-requirements.md](./reservation-schedule-requirements.md) ì°¸ì¡°

1. **ê³„ì•½ ì™„ë£Œ ì „ìš© í˜ì´ì§€**:
   - `status = 'contract_completed'` + `contract_completed_at IS NOT NULL` í•„í„°ë§
   - ë‚ ì§œë³„ ê·¸ë£¹í™” ë¦¬ìŠ¤íŠ¸ ë·°
   - Emerald/Teal ìƒ‰ìƒ ì‹œìŠ¤í…œ

2. **ì¹´ë“œ ì¸í„°ë™ì…˜**:
   - ê¸°ë³¸: ì´ë¦„, ì‹œê°„, ëœë”©í˜ì´ì§€ í‘œì‹œ
   - í˜¸ë²„: ì—°ë½ì²˜ ì •ë³´ ë…¸ì¶œ (decryptPhone) â† **í•µì‹¬ ê¸°ëŠ¥**
   - í´ë¦­: DB í˜„í™© ìë™ í•„í„°ë§ ì´ë™

3. **í˜ì´ì§€ êµ¬ì„±**:
   - í—¤ë”: ì´ ì˜ˆì•½ ê±´ìˆ˜ í‘œì‹œ
   - ì¼ì • ë¦¬ìŠ¤íŠ¸: ë‚ ì§œë³„ ê·¸ë£¹í™”ëœ ì˜ˆì•½ ì¹´ë“œ
   - í€µ ì•¡ì…˜: "ëª¨ë“  ê³„ì•½ ì™„ë£Œ ê±´ ë³´ê¸°", "ìº˜ë¦°ë” ë·°ë¡œ ë³´ê¸°"
