# Meta Pixel Visual Implementation Guide

## ğŸ¨ Visual Architecture Overview

### 1ï¸âƒ£ Configuration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STEP 1: CONFIGURE PIXEL                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    ğŸ‘¤ Dashboard User
                         â”‚
                         â”‚ Navigate to settings
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   /dashboard/settings/tracking-    â”‚
        â”‚           pixels                   â”‚
        â”‚                                    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ Facebook Pixel ID            â”‚ â”‚
        â”‚  â”‚ [906463148573823         ]   â”‚ â”‚
        â”‚  â”‚                              â”‚ â”‚
        â”‚  â”‚ Google Analytics ID          â”‚ â”‚
        â”‚  â”‚ [                        ]   â”‚ â”‚
        â”‚  â”‚                              â”‚ â”‚
        â”‚  â”‚ â˜‘ í”½ì…€ ì¶”ì  í™œì„±í™”            â”‚ â”‚
        â”‚  â”‚                              â”‚ â”‚
        â”‚  â”‚      [ ì €ì¥í•˜ê¸° ]             â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Click Save
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Supabase Client (RLS)          â”‚
        â”‚                                    â”‚
        â”‚  if (initialData) {                â”‚
        â”‚    UPDATE tracking_pixels          â”‚
        â”‚    SET facebook_pixel_id = '906..' â”‚
        â”‚    WHERE company_id = 'xxx'        â”‚
        â”‚  } else {                          â”‚
        â”‚    INSERT INTO tracking_pixels     â”‚
        â”‚    VALUES (company_id, '906..')    â”‚
        â”‚  }                                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    tracking_pixels Table           â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ company_id: 971983c1-...           â”‚
        â”‚ facebook_pixel_id: 906463148573823 â”‚
        â”‚ google_analytics_id: null          â”‚
        â”‚ is_active: true                    â”‚
        â”‚ created_at: 2025-12-13...          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ âœ… Saved!
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  "í”½ì…€ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!"      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2ï¸âƒ£ Public Page Load Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                STEP 2: PUBLIC VISITOR LOADS PAGE                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    ğŸŒ Public Visitor
                         â”‚
                         â”‚ Visit landing page
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  https://medisync.com/             â”‚
        â”‚  ABC123/landing/consultation       â”‚
        â”‚                                    â”‚
        â”‚  URL Structure:                    â”‚
        â”‚  /{companyShortId}/landing/{slug}  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Next.js SSR
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Server Component: page.tsx       â”‚
        â”‚                                    â”‚
        â”‚  const supabase =                  â”‚
        â”‚    getServiceRoleClient()          â”‚
        â”‚                                    â”‚
        â”‚  // Fetch company by short_id      â”‚
        â”‚  const { data: company } = await   â”‚
        â”‚    supabase                        â”‚
        â”‚      .from('companies')            â”‚
        â”‚      .select(`                     â”‚
        â”‚        id,                         â”‚
        â”‚        short_id,                   â”‚
        â”‚        tracking_pixels(*)          â”‚
        â”‚      `)                            â”‚
        â”‚      .eq('short_id', 'ABC123')     â”‚
        â”‚      .single()                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Database Query (Service Role)
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Database Response             â”‚
        â”‚                                    â”‚
        â”‚  {                                 â”‚
        â”‚    id: "09d7dcb7...",             â”‚
        â”‚    short_id: "ABC123",            â”‚
        â”‚    tracking_pixels: [             â”‚
        â”‚      {                            â”‚
        â”‚        facebook_pixel_id:         â”‚
        â”‚          "906463148573823",       â”‚
        â”‚        is_active: true            â”‚
        â”‚      }                            â”‚
        â”‚    ]                              â”‚
        â”‚  }                                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Pass to client component
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Client Component:                 â”‚
        â”‚  PublicLandingPage.tsx             â”‚
        â”‚                                    â”‚
        â”‚  const trackingPixels =            â”‚
        â”‚    landingPage                     â”‚
        â”‚      .companies                    â”‚
        â”‚      ?.tracking_pixels?.[0]        â”‚
        â”‚                                    â”‚
        â”‚  // Extract pixel data:            â”‚
        â”‚  // facebook_pixel_id:             â”‚
        â”‚  //   "906463148573823"            â”‚
        â”‚  // is_active: true                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Render conditionally
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Conditional Rendering Check      â”‚
        â”‚                                    â”‚
        â”‚  if (trackingPixels?.is_active &&  â”‚
        â”‚      trackingPixels                â”‚
        â”‚        ?.facebook_pixel_id) {      â”‚
        â”‚    // âœ… Render pixel script       â”‚
        â”‚  } else {                          â”‚
        â”‚    // âŒ Skip pixel injection      â”‚
        â”‚  }                                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ âœ… Both conditions true
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   <Script> Tag Injection           â”‚
        â”‚                                    â”‚
        â”‚  <Script                           â”‚
        â”‚    id="facebook-pixel"             â”‚
        â”‚    strategy="afterInteractive"     â”‚
        â”‚  >                                 â”‚
        â”‚    !function(f,b,e,v,n,t,s){...}   â”‚
        â”‚    fbq('init',                     â”‚
        â”‚      '906463148573823');           â”‚
        â”‚    fbq('track', 'PageView');       â”‚
        â”‚  </Script>                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTML rendered
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Browser Receives HTML         â”‚
        â”‚                                    â”‚
        â”‚  <html>                            â”‚
        â”‚    <head>                          â”‚
        â”‚      <script>                      â”‚
        â”‚        !function(f,b,e,...){...}   â”‚
        â”‚      </script>                     â”‚
        â”‚    </head>                         â”‚
        â”‚    <body>...</body>                â”‚
        â”‚  </html>                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Execute after interactive
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Browser JavaScript Execution     â”‚
        â”‚                                    â”‚
        â”‚  1. Load fbevents.js from:         â”‚
        â”‚     connect.facebook.net           â”‚
        â”‚                                    â”‚
        â”‚  2. Initialize pixel:              â”‚
        â”‚     fbq('init',                    â”‚
        â”‚       '906463148573823')           â”‚
        â”‚                                    â”‚
        â”‚  3. Track PageView:                â”‚
        â”‚     fbq('track', 'PageView')       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Send tracking event
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Facebook Servers              â”‚
        â”‚                                    â”‚
        â”‚  Pixel ID: 906463148573823         â”‚
        â”‚  Event: PageView                   â”‚
        â”‚  URL: /ABC123/landing/consultation â”‚
        â”‚  Timestamp: 2026-01-08...          â”‚
        â”‚                                    â”‚
        â”‚  âœ… Event Tracked!                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3ï¸âƒ£ Multi-Page Automatic Application

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         STEP 3: AUTOMATIC APPLICATION TO ALL PAGES               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                   ğŸ¢ Company: ABC Medical
                   ğŸ“Š Pixel ID: 906463148573823
                         â”‚
                         â”‚ Configured once in
                         â”‚ tracking_pixels table
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   tracking_pixels Table            â”‚
        â”‚   (ONE record per company)         â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ company_id: ABC-COMPANY-UUID       â”‚
        â”‚ facebook_pixel_id: 906463148573823 â”‚
        â”‚ is_active: true                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Shared by ALL landing pages
                 â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚           â”‚           â”‚           â”‚
     â–¼           â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Landing  â”‚ â”‚Landing  â”‚ â”‚Landing  â”‚ â”‚Landing  â”‚
â”‚Page 1   â”‚ â”‚Page 2   â”‚ â”‚Page 3   â”‚ â”‚Page N   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Slug:    â”‚ â”‚Slug:    â”‚ â”‚Slug:    â”‚ â”‚Slug:    â”‚
â”‚consult  â”‚ â”‚special  â”‚ â”‚product  â”‚ â”‚...      â”‚
â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚
â”‚Pixel:   â”‚ â”‚Pixel:   â”‚ â”‚Pixel:   â”‚ â”‚Pixel:   â”‚
â”‚906...823â”‚ â”‚906...823â”‚ â”‚906...823â”‚ â”‚906...823â”‚
â”‚         â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚
â”‚âœ… Activeâ”‚ â”‚âœ… Activeâ”‚ â”‚âœ… Activeâ”‚ â”‚âœ… Activeâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

           â¬‡ï¸  Each page independently fetches
              tracking_pixels via company_id

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  URL: /ABC123/landing/consult                  â”‚
â”‚  â†“ Fetches company ABC123                     â”‚
â”‚  â†“ JOINs tracking_pixels                      â”‚
â”‚  âœ… Injects pixel 906463148573823              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  URL: /ABC123/landing/special                  â”‚
â”‚  â†“ Fetches company ABC123                     â”‚
â”‚  â†“ JOINs tracking_pixels                      â”‚
â”‚  âœ… Injects pixel 906463148573823              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  URL: /ABC123/landing/product                  â”‚
â”‚  â†“ Fetches company ABC123                     â”‚
â”‚  â†“ JOINs tracking_pixels                      â”‚
â”‚  âœ… Injects pixel 906463148573823              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4ï¸âƒ£ Live Update Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 4: REAL-TIME PIXEL UPDATES                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                  â° Timeline View
                         â”‚
                         â”‚
      T0 (Initial)       â”‚      T1 (Update)       â”‚      T2 (New Visitor)
                         â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard Admin  â”‚     â”‚  â”‚ Dashboard Admin  â”‚  â”‚  â”‚  New Visitor     â”‚
â”‚ Configures:      â”‚     â”‚  â”‚ Changes to:      â”‚  â”‚  â”‚  Arrives          â”‚
â”‚ 906463148573823  â”‚     â”‚  â”‚ 999888777666     â”‚  â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚           â”‚            â”‚           â”‚
         â”‚ Save          â”‚           â”‚ Save       â”‚           â”‚ Visit page
         â–¼               â”‚           â–¼            â”‚           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tracking_pixels  â”‚     â”‚  â”‚ tracking_pixels  â”‚  â”‚  â”‚ Server Query     â”‚
â”‚                  â”‚     â”‚  â”‚                  â”‚  â”‚  â”‚ (Service Role)   â”‚
â”‚ pixel_id:        â”‚     â”‚  â”‚ pixel_id:        â”‚  â”‚  â”‚                  â”‚
â”‚ 906463148573823  â”‚     â”‚  â”‚ 999888777666     â”‚  â”‚  â”‚ SELECT * FROM    â”‚
â”‚                  â”‚     â”‚  â”‚                  â”‚  â”‚  â”‚ tracking_pixels  â”‚
â”‚ âœ… Saved         â”‚     â”‚  â”‚ âœ… Updated       â”‚  â”‚  â”‚ WHERE company_id â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                        â”‚           â”‚
         â”‚               â”‚           â”‚            â”‚           â”‚ Latest data
         â”‚               â”‚           â”‚            â”‚           â–¼
         â–¼               â”‚           â–¼            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ Response:        â”‚
â”‚ Visitor A sees:  â”‚     â”‚  â”‚ Visitor B sees:  â”‚  â”‚  â”‚ pixel_id:        â”‚
â”‚ 906463148573823  â”‚     â”‚  â”‚ 999888777666     â”‚  â”‚  â”‚ 999888777666     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                        â”‚           â”‚
                         â”‚                        â”‚           â”‚ Inject pixel
                         â”‚                        â”‚           â–¼
                         â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                        â”‚  â”‚ <Script>         â”‚
                         â”‚                        â”‚  â”‚ fbq('init',      â”‚
                         â”‚                        â”‚  â”‚ '999888777666')  â”‚
                         â”‚                        â”‚  â”‚ </Script>        â”‚
                         â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                        â”‚
                         â–¼                        â–¼           â–¼
         â±ï¸ 10:00 AM           â±ï¸ 10:30 AM        â±ï¸ 10:31 AM

ğŸ”„ NO CACHE INVALIDATION NEEDED
   Each request fetches latest data from database
```

---

### 5ï¸âƒ£ Multi-Company Isolation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            STEP 5: COMPANY-LEVEL DATA ISOLATION                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ¢ Company A          ğŸ¢ Company B          ğŸ¢ Company C
    (ABC Medical)         (XYZ Clinic)          (DEF Hospital)
         â”‚                     â”‚                     â”‚
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚tracking_pixels  â”‚   â”‚tracking_pixels  â”‚   â”‚tracking_pixels  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚company_id: AAA  â”‚   â”‚company_id: BBB  â”‚   â”‚company_id: CCC  â”‚
â”‚pixel_id:        â”‚   â”‚pixel_id:        â”‚   â”‚pixel_id:        â”‚
â”‚906463148573823  â”‚   â”‚111222333444     â”‚   â”‚555666777888     â”‚
â”‚is_active: true  â”‚   â”‚is_active: true  â”‚   â”‚is_active: false â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â”‚ RLS Policy          â”‚ RLS Policy          â”‚ RLS Policy
         â”‚ WHERE               â”‚ WHERE               â”‚ WHERE
         â”‚ company_id = AAA    â”‚ company_id = BBB    â”‚ company_id = CCC
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Landing Pages   â”‚   â”‚ Landing Pages   â”‚   â”‚ Landing Pages   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /AAA/landing/a  â”‚   â”‚ /BBB/landing/x  â”‚   â”‚ /CCC/landing/p  â”‚
â”‚ Pixel:          â”‚   â”‚ Pixel:          â”‚   â”‚ âŒ No Pixel     â”‚
â”‚ 906463148573823 â”‚   â”‚ 111222333444    â”‚   â”‚ (is_active=falseâ”‚
â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚
â”‚ /AAA/landing/b  â”‚   â”‚ /BBB/landing/y  â”‚   â”‚ /CCC/landing/q  â”‚
â”‚ Pixel:          â”‚   â”‚ Pixel:          â”‚   â”‚ âŒ No Pixel     â”‚
â”‚ 906463148573823 â”‚   â”‚ 111222333444    â”‚   â”‚                 â”‚
â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚
â”‚ /AAA/landing/c  â”‚   â”‚ /BBB/landing/z  â”‚   â”‚ /CCC/landing/r  â”‚
â”‚ Pixel:          â”‚   â”‚ Pixel:          â”‚   â”‚ âŒ No Pixel     â”‚
â”‚ 906463148573823 â”‚   â”‚ 111222333444    â”‚   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ ISOLATION GUARANTEES:
   - Company A cannot see Company B's pixel data
   - Company B cannot modify Company C's settings
   - RLS policies enforce strict company_id matching
   - Each company's landing pages use ONLY their pixel
```

---

### 6ï¸âƒ£ Conditional Rendering Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          STEP 6: PIXEL INJECTION DECISION TREE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            Start: PublicLandingPage renders
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Extract tracking pixels data:      â”‚
        â”‚                                    â”‚
        â”‚ const trackingPixels =             â”‚
        â”‚   landingPage                      â”‚
        â”‚     .companies                     â”‚
        â”‚     ?.tracking_pixels?.[0]         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Check: Does tracking_pixels exist? â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
        YES              NO
         â”‚                â”‚
         â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Continue â”‚     â”‚Skip pixelâ”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚injection â”‚
         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                âŒ No pixel renders
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check: Is is_active === true?     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                â”‚
YES              NO
 â”‚                â”‚
 â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Continue â”‚  â”‚Skip pixelâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚injection â”‚
     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             âŒ Pixel disabled
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check: Does facebook_pixel_id      â”‚
â”‚        exist and not empty?        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                â”‚
YES              NO
 â”‚                â”‚
 â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Inject   â”‚  â”‚Skip pixelâ”‚
â”‚Pixel!   â”‚  â”‚injection â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             âŒ No pixel ID configured
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Render <Script> Tag            â”‚
â”‚                                    â”‚
â”‚  <Script                           â”‚
â”‚    id="facebook-pixel"             â”‚
â”‚    strategy="afterInteractive"     â”‚
â”‚  >                                 â”‚
â”‚    !function(f,b,e,v,n,t,s){...}   â”‚
â”‚    fbq('init', 'PIXEL_ID');        â”‚
â”‚    fbq('track', 'PageView');       â”‚
â”‚  </Script>                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7ï¸âƒ£ Performance Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STEP 7: NEXT.JS SCRIPT LOADING STRATEGY                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Browser Page Load Timeline
                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚                    â”‚
    â–¼                    â–¼                    â–¼
  [HTML]            [Critical JS]       [Interactive]
  Parse             Main Bundle         User Can Click
    â”‚                    â”‚                    â”‚
    â”‚ â±ï¸ 0-100ms         â”‚ â±ï¸ 100-500ms       â”‚ â±ï¸ 500ms+
    â”‚                    â”‚                    â”‚
    â”‚                    â”‚                    â–¼
    â”‚                    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚          â”‚ strategy=        â”‚
    â”‚                    â”‚          â”‚ "afterInteractiveâ”‚
    â”‚                    â”‚          â”‚                  â”‚
    â”‚                    â”‚          â”‚ Meta Pixel loads â”‚
    â”‚                    â”‚          â”‚ AFTER page       â”‚
    â”‚                    â”‚          â”‚ becomes          â”‚
    â”‚                    â”‚          â”‚ interactive      â”‚
    â”‚                    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                    â”‚                   â”‚
    â”‚                    â”‚                   â–¼
    â”‚                    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚          â”‚ Load fbevents.js â”‚
    â”‚                    â”‚          â”‚ from Facebook CDNâ”‚
    â”‚                    â”‚          â”‚                  â”‚
    â”‚                    â”‚          â”‚ â±ï¸ Non-blocking  â”‚
    â”‚                    â”‚          â”‚ â±ï¸ Async loading â”‚
    â”‚                    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                    â”‚                   â”‚
    â”‚                    â”‚                   â–¼
    â”‚                    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚          â”‚ Execute:         â”‚
    â”‚                    â”‚          â”‚ fbq('init', ...) â”‚
    â”‚                    â”‚          â”‚ fbq('track', ...)â”‚
    â”‚                    â”‚          â”‚                  â”‚
    â”‚                    â”‚          â”‚ âœ… Tracking      â”‚
    â”‚                    â”‚          â”‚    started!      â”‚
    â”‚                    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                    â”‚
    â–¼                    â–¼
  [Render]          [Hydrate]
  Complete          Complete


âš¡ PERFORMANCE BENEFITS:
   âœ… Doesn't block initial page render
   âœ… Doesn't delay Time to Interactive (TTI)
   âœ… Doesn't affect First Contentful Paint (FCP)
   âœ… Loads in background after user can interact
   âœ… Optimal Core Web Vitals scores
```

---

### 8ï¸âƒ£ Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 8: ROW-LEVEL SECURITY (RLS)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        ğŸ” RLS Policy Enforcement
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
   [SELECT]         [INSERT]         [UPDATE]
    Policy           Policy           Policy
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USING (     â”‚  â”‚ WITH CHECK (â”‚  â”‚ USING (     â”‚
â”‚  company_id â”‚  â”‚  company_id â”‚  â”‚  company_id â”‚
â”‚  IN (       â”‚  â”‚  IN (       â”‚  â”‚  IN (       â”‚
â”‚   SELECT    â”‚  â”‚   SELECT    â”‚  â”‚   SELECT    â”‚
â”‚   company_idâ”‚  â”‚   company_idâ”‚  â”‚   company_idâ”‚
â”‚   FROM usersâ”‚  â”‚   FROM usersâ”‚  â”‚   FROM usersâ”‚
â”‚   WHERE id= â”‚  â”‚   WHERE id= â”‚  â”‚   WHERE id= â”‚
â”‚   auth.uid()â”‚  â”‚   auth.uid()â”‚  â”‚   auth.uid()â”‚
â”‚  )          â”‚  â”‚  )          â”‚  â”‚  )          â”‚
â”‚ )           â”‚  â”‚ )           â”‚  â”‚ )           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â–¼                â–¼                â–¼
   âœ… Allows        âœ… Allows        âœ… Allows
   viewing own     creating own     updating own
   pixels          pixels           pixels
       â”‚                â”‚                â”‚
       â–¼                â–¼                â–¼
   âŒ Blocks        âŒ Blocks        âŒ Blocks
   viewing other   creating for     updating other
   companies       other companies  companies


ğŸ›¡ï¸ SECURITY GUARANTEES:
   1. Dashboard users can ONLY access their company's pixels
   2. Cannot read other companies' pixel configurations
   3. Cannot modify other companies' settings
   4. Public pages use Service Role (bypasses RLS safely)
   5. Service Role only in server components (not exposed)
```

---

## ğŸ¯ Key Takeaways

### What Makes This Implementation Special?

1. **ğŸ”„ Dynamic & Automatic**
   - One configuration applies to ALL landing pages
   - No manual pixel insertion per page
   - Instant updates across all pages

2. **ğŸ”’ Secure & Isolated**
   - Company-level data isolation via RLS
   - No cross-company data leakage
   - Secure service role usage

3. **âš¡ High Performance**
   - Non-blocking script loading
   - Next.js optimization
   - No impact on page load speed

4. **ğŸ¨ Multi-Platform**
   - Supports 7 advertising platforms
   - Extensible architecture
   - Easy to add more platforms

5. **âœ… Production-Ready**
   - Already deployed and working
   - Well-tested codebase
   - Comprehensive documentation

---

## ğŸ“Š Visual Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE SYSTEM FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Dashboard          Database          Public Pages        Facebook
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚ Configure        â”‚                   â”‚                 â”‚
       â”‚ pixel            â”‚                   â”‚                 â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚                 â”‚
       â”‚ 906463148573823  â”‚                   â”‚                 â”‚
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚ Store pixel       â”‚                 â”‚
       â”‚                  â”‚ (company_id)      â”‚                 â”‚
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚                   â”‚ Visitor arrives â”‚
       â”‚                  â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚ Fetch pixel       â”‚                 â”‚
       â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚ Return pixel data â”‚                 â”‚
       â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                 â”‚
       â”‚                  â”‚ (906463148573823) â”‚                 â”‚
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚                   â”‚ Inject <Script> â”‚
       â”‚                  â”‚                   â”‚ fbq('init',...) â”‚
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚                   â”‚ Track PageView  â”‚
       â”‚                  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                  â”‚                   â”‚                 â”‚
       â”‚                  â”‚                   â”‚                 â”‚ âœ…
       â–¼                  â–¼                   â–¼                 â–¼

    Settings           Pixels            Landing Pages    Analytics
    Page               Table             (All Pages)      Tracked
```

---

**Created**: 2026-01-08
**Status**: âœ… Production Implementation Complete
